version: "3.9"
services:
  mosquitto:
    image: eclipse-mosquitto:2
    ports: ["1883:1883"]
    volumes:
      - ./mosquitto/mosquitto.conf:/mosquitto/config/mosquitto.conf
      - ./mosquitto/acl:/mosquitto/config/acl
      - ./mosquitto/passwd:/mosquitto/passwd
      - ./mosquitto/data:/mosquitto/data
    restart: unless-stopped

  nodered:
    image: nodered/node-red:latest
    environment: ["TZ=Europe/Prague"]
    ports: ["1880:1880"]
    volumes:
      - ./nodered/data:/data                
      - ./nodered/data/sqlite:/data/sqlite
    depends_on: [mosquitto]
    restart: unless-stopped

  caddy:
    image: caddy:latest
    ports: ["80:80"]
    volumes:
      - ./caddy/Caddyfile:/etc/caddy/Caddyfile:ro
      - ./caddy/ota:/srv/ota
    depends_on: [nodered]
    restart: unless-stopped
